app-id: com.github.makhber.Makhber
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: 5.15-21.08
command: makhber
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --filesystem=home
  - --filesystem=/media
  - --filesystem=/run/media
  - --device=dri

modules:
  - name: gsl
    config-opts:
      - --disable-static
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gsl/gsl-2.7.1.tar.gz
        sha256: dcb0fbd43048832b757ff9942691a8dd70026d5da0ff85601e52687f6deeb34b
        x-checker-data:
          type: anitya
          project-id: 1267
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gsl/gsl-$version.tar.gz

  - name: muparser
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://github.com/beltoforion/muparser/archive/v2.3.2.tar.gz
        sha256: b35fc84e3667d432e3414c8667d5764dfa450ed24a99eeef7ee3f6647d44f301
        x-checker-data:
          type: anitya
          project-id: 2033
          stable-only: true
          url-template: https://github.com/beltoforion/muparser/archive/v$version.tar.gz

  - name: glu
    config-opts:
      - --disable-static
      - --disable-debug
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.2.tar.gz
        sha256: 24effdfb952453cc00e275e1c82ca9787506aba0282145fff054498e60e19a65
        x-checker-data:
          type: anitya
          project-id: 13518
          stable-only: true
          url-template: https://mesa.freedesktop.org/archive/glu/glu-$version.tar.gz
    cleanup:
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/pkgconfig

  - python3-pyqt-builder.json

  - name: pyqt5-sip
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=/app
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/b1/40/dd8f081f04a12912b65417979bf2097def0af0f20c89083ada3670562ac5/PyQt5_sip-12.9.0.tar.gz
        sha256: d3e4489d7c2b0ece9d203ae66e573939f7f60d4d29e089c9f11daa17cfeaae32
        x-checker-data:
          type: pypi
          name: PyQt5-sip

  - name: pyqt5
    buildsystem: simple
    build-commands:
      - sip-install --confirm-license --build-dir ./build --target-dir /app/lib/python3.9/site-packages
        --concatenate 1 --no-designer-plugin --no-qml-plugin --no-tools --disable
        QtQml --disable QtBluetooth --disable QtDBus --disable QtDesigner --disable
        QtHelp --disable QtMultimedia --disable QtMultimediaWidgets --disable QtNfc
        --disable QtRemoteObjects --disable QtPositioning --disable QtLocation --disable
        QtQuick --disable QtQuickWidgets --disable QtSensors --disable QtSerialPort
        --disable QtSql --disable QtTest --disable QtTextToSpeech --disable QtWebChannel
        --disable QtWebKit --disable QtWebKitWidgets --disable QtWebSockets --disable
        QtX11Extras --disable QtXml --disable QtXmlPatterns --verbose --jobs $(nproc)
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/3b/27/fd81188a35f37be9b3b4c2db1654d9439d1418823916fe702ac3658c9c41/PyQt5-5.15.6.tar.gz
        sha256: 80343bcab95ffba619f2ed2467fd828ffeb0a251ad7225be5fc06dcc333af452
        x-checker-data:
          type: pypi
          name: PyQt5

  - name: makhber
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DMAKHBER_SEARCH_FOR_UPDATES=OFF
      - -DMAKHBER_DOWNLOAD_LINKS=OFF
      - -DMAKHBER_SCRIPTING_PYTHON=ON
    sources:
      - type: archive
        url: https://github.com/Makhber/makhber/releases/download/0.9.4.2/Makhber-0.9.4.2-src.tar.xz
        sha256: 198a4aa6ab63a7b8a9f170d207ad08dd35b3098c10990ad2a8bca584f3d0619f
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Makhber/makhber/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="Makhber-" + $version + "-src.tar.xz")
            | .browser_download_url
