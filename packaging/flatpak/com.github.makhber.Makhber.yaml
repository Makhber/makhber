app-id: com.github.makhber.Makhber
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: 5.15-21.08
command: makhber
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --filesystem=home
  - --filesystem=/media
  - --filesystem=/run/media
  - --device=dri

modules:
  - name: gsl
    buildsystem: autotools
    config-opts:
      - --disable-static
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gsl/gsl-2.7.1.tar.gz
        sha256: dcb0fbd43048832b757ff9942691a8dd70026d5da0ff85601e52687f6deeb34b
        x-checker-data:
          type: anitya
          project-id: 1267
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gsl/gsl-$version.tar.gz

  - name: muparser
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - /include
      - /lib/pkgconfig
      - /lib/cmake
    sources:
      - type: archive
        url: https://github.com/beltoforion/muparser/archive/v2.3.3-1.tar.gz
        sha256: 91d26d8274ae9cd9c776ee58250aeddc6b574f369eafd03b25045b858a2b8177
        x-checker-data:
          type: anitya
          project-id: 2033
          stable-only: true
          url-template: https://github.com/beltoforion/muparser/archive/v$version.tar.gz

  - name: glu
    buildsystem: autotools
    config-opts:
      - --disable-static
      - --disable-debug
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.2.tar.gz
        sha256: 24effdfb952453cc00e275e1c82ca9787506aba0282145fff054498e60e19a65
        x-checker-data:
          type: anitya
          project-id: 13518
          stable-only: true
          url-template: https://mesa.freedesktop.org/archive/glu/glu-$version.tar.gz
    cleanup:
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/pkgconfig

  - name: gl2ps
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://geuz.org/gl2ps/src/gl2ps-1.4.2.tgz
        sha256: 8d1c00c1018f96b4b97655482e57dcb0ce42ae2f1d349cd6d4191e7848d9ffe9
        x-checker-data:
          type: anitya
          project-id: 1173
          stable-only: true
          url-template: https://geuz.org/gl2ps/src/gl2ps-$version.tgz
    cleanup:
      - /lib/libgl2ps.a
      - /include
      - /share

  - name: python3-flit_core
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "flit_core" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ad/38/80992c4cb490a05474c886850ec818276d09c0a6722bd5b43bc487818ac7/flit_core-3.7.1-py3-none-any.whl
        sha256: e454fdbf68c7036e1c7435ec7479383f9d9a1650ca5b304feb184eba1efcdcef
        x-checker-data:
          name: flit_core
          packagetype: bdist_wheel
          type: pypi
    cleanup:
      - '*'

  - name: python3-pyqt-builder
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyqt-builder" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/05/8e/8de486cbd03baba4deef4142bd643a3e7bbe954a784dc1bb17142572d127/packaging-21.3-py3-none-any.whl
        sha256: ef103e05f519cdc783ae24ea4e2e0f508a9c99b2d4969652eed6a2e1ea5bd522
        x-checker-data:
          name: packaging
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/a3/58/35da89ee790598a0700ea49b2a66594140f44dec458c07e8e3d4979137fc/ply-3.11-py2.py3-none-any.whl
        sha256: 096f9b8350b65ebd2fd1346b12452efe5b9607f7482813ffca50c22722a807ce
        x-checker-data:
          name: ply
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/6c/10/a7d0fa5baea8fe7b50f448ab742f26f52b80bfca85ac2be9d35cdd9a3246/pyparsing-3.0.9-py3-none-any.whl
        sha256: 5026bae9a10eeaefb61dab2f09052b9f4307d44aee4eda64b309723d8d206bbc
        x-checker-data:
          name: pyparsing
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/b8/80/dfcc80e48bcac4fe60cec378d116ec805ed180474fbfecc3fad33583d35b/PyQt_builder-1.13.0-py3-none-any.whl
        sha256: e3b32eebf4519515f86abd1b908c3cdae613c0614cfbb09b6acaca3db0f5a0c2
        x-checker-data:
          name: PyQt_builder
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/5b/cb/c27c925ae07bd03a2597fa1db17bfc2a4ac57da61aeb90f8ec98ffbb975b/sip-6.6.2.tar.gz
        sha256: 0e3efac1c5dfd8e525ae57140927df26993e13f58b89d1577c314f4105bfd90d
        x-checker-data:
          name: sip
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/44/6f/7120676b6d73228c96e17f1f794d8ab046fc910d781c8d151120c3f1569e/toml-0.10.2-py2.py3-none-any.whl
        sha256: 806143ae5bfb6a3c6e736a764057db0e6a0e05e338b5630894a5f779cabb4f9b
        x-checker-data:
          name: toml
          packagetype: bdist_wheel
          type: pypi
    cleanup:
      - '*'

  - name: pyqt5-sip
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=/app
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/39/5f/fd9384fdcb9cd0388088899c110838007f49f5da1dd1ef6749bfb728a5da/PyQt5_sip-12.11.0.tar.gz
        sha256: b4710fd85b57edef716cc55fae45bfd5bfac6fc7ba91036f1dcc3f331ca0eb39
        x-checker-data:
          type: pypi
          name: PyQt5-sip

  - name: pyqt5
    buildsystem: simple
    build-commands:
      - sip-install --confirm-license --build-dir ./build --target-dir /app/lib/python3.9/site-packages
        --concatenate $(nproc) --no-designer-plugin --no-qml-plugin --no-tools --disable
        QtQml --disable QtBluetooth --disable QtDBus --disable QtDesigner --disable
        QtHelp --disable QtMultimedia --disable QtMultimediaWidgets --disable QtNfc
        --disable QtRemoteObjects --disable QtPositioning --disable QtLocation --disable
        QtQuick --disable QtQuickWidgets --disable QtSensors --disable QtSerialPort
        --disable QtSql --disable QtTest --disable QtTextToSpeech --disable QtWebChannel
        --disable QtWebKit --disable QtWebKitWidgets --disable QtWebSockets --disable
        QtX11Extras --disable QtXml --disable QtXmlPatterns --verbose --jobs $(nproc)
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/e1/57/2023316578646e1adab903caab714708422f83a57f97eb34a5d13510f4e1/PyQt5-5.15.7.tar.gz
        sha256: 755121a52b3a08cb07275c10ebb96576d36e320e572591db16cfdbc558101594
        x-checker-data:
          type: pypi
          name: PyQt5
    cleanup:
      - /lib/python3.9/site-packages/PyQt5/bindings

  - name: makhber
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DMAKHBER_SEARCH_FOR_UPDATES=OFF
      - -DMAKHBER_DOWNLOAD_LINKS=OFF
      - -DMAKHBER_SCRIPTING_PYTHON=ON
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: dir
        path: ../..
